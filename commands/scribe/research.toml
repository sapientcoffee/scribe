description = "Searches for information on a topic and compiles a research dossier within a new project directory."
prompt = """
@{context/core.md}
@{context/researcher.md}

## Task: Research & Dossier Creation

A user has requested you research the following topic: {{args}}

## 1. Research Protocol (Strict Rules)
*   **Centralized Project Directory:** You MUST create a dedicated subdirectory under a root `scribe/` directory for this project (e.g., `scribe/<project-name>/`). The `project-name` should be derived from the topic, slugified. All workflow files for this project must reside within this new directory.
*   **ReadOnly Mode (During Research):** You may *not* edit any source code or existing documents outside the new project directory unless explicitly asked. Your job is to read, synthesize, and report.
*   **Source Hierarchy:**
    1.  User-provided links/files (Highest Truth).
    2.  Local Context (File system, MCP context within the new project directory).
    3.  Web Search (General knowledge).
*   **Conflict Resolution:** If user-provided context contradicts web search, trust the user-provided context.
*   **Clarify Ambiguity:** Before performing the research and writing `RESEARCH.md`, if the user's request (`{{args}}`) is vague, ambiguous, or lacks sufficient detail, you must present a brief summary of your understanding and ask clarifying questions to ensure you can provide a high-quality research dossier. If the request is clear, proceed directly.

## 2. File Handling & Output Location
*   **Target File:** You will output your findings to `RESEARCH.md` within the new project directory.
*   **Collision Check (Project Directory):**
    *   Before creating the new project directory, check if a directory with the same `project-name` already exists under `scribe/`.
    *   If it exists, **stop and ask the user** how to proceed. You must offer at least these options:
        1.  **Overwrite:** Delete the existing project directory and create a new one.
        2.  **Use Existing:** Proceed within the existing project directory (implying the user wants to append/update `RESEARCH.md` within that context).
        3.  **New Version:** Create a new project directory with a version suffix (e.g., `scribe/<project-name>-v2/`).
    *   Do not proceed until you have a decision.
*   **Collision Check (`RESEARCH.md`):**
    *   If `RESEARCH.md` already exists within the chosen project directory, **stop and ask the user** how to proceed. You must offer at least these options:
        1.  **Overwrite:** Replace the existing file.
        2.  **Append:** Add the new research to the end of the existing file.
        3.  **New Version:** Create a new versioned file (e.g., `RESEARCH_v2.md`).
    *   Do not write content until you have a decision.

## 3. The "Dossier" Output Format
Your final output in `RESEARCH.md` must follow this structure so the Architect (the next step) can read it easily:

# Research Dossier: [Topic Name]

## Executive Summary
*   [3-5 bullet points summarizing the most critical takeaways]

## Key Findings
*   **Finding 1:** [Detail] (Source: [Link/File])
*   **Finding 2:** [Detail] (Source: [Link/File])

## Technical Context & Constraints
*   [List specific libraries, versions, or architectural patterns discovered]
*   [List any conflicting information found]

## Raw Notes / Snippets
*   [Direct quotes or code snippets that are highly relevant]

---

## 4. Completion Criteria
*   Do not mark the task as complete until you have:
    1.  Consulted multiple sources (if applicable).
    2.  Successfully created the project directory and written the `RESEARCH.md` file.
    3.  Received explicit confirmation from the user.
*   **Next Step:** Once confirmed, suggest the user run: `/scribe:plan <project-name>` to generate the project blueprint.

## 5. Error Handling
*   If the `scribe/` root directory cannot be created or accessed, provide clear instructions for manual creation and suggest checking permissions.
*   If a project subdirectory cannot be created due to permissions or naming conflicts (beyond the collision check), inform the user and suggest alternative names or manual creation.
*   If file write operations fail, provide specific error messages and suggested solutions.

## 6. File Validation
*   Ensure that any URLs provided by the user are valid before attempting to fetch their content.
*   Verify that `RESEARCH.md` (after creation) contains valid Markdown formatting.

---
*User Request: {{args}}*
"""